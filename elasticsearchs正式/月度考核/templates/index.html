<!DOCTYPE html>
<html lang="zh-CN">
    <head>

        <title>Dashboard Template for Bootstrap</title>
        <link href='{{ static_url("css/bootstrap.min.css") }}' rel="stylesheet">
        <link href='{{ static_url("css/index.css") }}' rel="stylesheet">
        <!-- 引入其他所有网页的内容 -->
        <!-- company.html -->
        <script src='{{ static_url("js/echarts.min.js") }}' ></script>
        <script src='{{ static_url("js/jquery.min.js") }}'></script>
        <link ref="stylesheet" href='{{ static_url("css/bootstrap-table.min.css") }}'>
        <script src='{{ static_url("js/bootstrap-table.min.js") }}'></script>
	    <script src='{{ static_url("js/bootstrap-table-zh-CN.js") }}'></script>
        <!-- company.html -->
        <!--bootstrap的自动补全 -->
        <script src='{{ static_url("js/bootstrap3-typeahead.min.js") }}'></script>

    </head>

  <body >

    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">数据查询接口</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="#">设置</a></li>
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">{{ user }} <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="#">信息</a></li>
                  <li><a href="/logout">退出</a></li>
                </ul>
              </li>
            <li><a href="#">帮助</a></li>
          </ul>
          <form class="navbar-form navbar-right">
            <input type="text" class="form-control" placeholder="查询...">
          </form>
        </div>
      </div>
    </nav>

    <div class="container-fluid">
      <div class="row">
        <div id="left" class="col-sm-3 col-md-2 sidebar">
          <ul class="nav nav-sidebar">
            <li class="active"><a href="#" onclick="showAtRight('/company/count')">公司数据汇总 </a></li>
			<li><a href="#" onclick="showAtRight('/employee/count')">单用户数据汇总</a></li>
			<li><a href="#" onclick="showAtRight('/echart/company')">公司拜访次数图表</a></li>
			<li><a href="#" onclick="showAtRight('/echart/person')">个人日拜分析</a></li>
			<li><a href="#" onclick="showAtRight('/echarts/api/company')">月拜分析</a></li>
          </ul>
          <!--<ul class="nav nav-sidebar">
            <li><a href="">Nav item</a></li> -->

        </div>

        <div style="padding-top: 0px" class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
          <div style="height: 20px ;weight:60px;
            display: inline-block;
            margin-top: 2px;
            padding: 0 0;
            margin-bottom: 20px;
          ">
              <h4 >
              <ol class="breadcrumb" >
                <li><a href="#">首页</a></li>
                <li><a href="#">分析</a></li>
              </ol>
          </h4>
          </div>
          <hr />

          <div id="content"></div>


        </div>
      </div>
    </div>


    <script src='{{ static_url("js/bootstrap.min.js") }}'></script>
    <script type="text/javascript">

        //点击时, 蓝色显示
        $(document).ready(function () {
            $('ul.nav > li').click(function (e) {
                //e.preventDefault();    加上这句则导航的<a>标签会失效
                $('ul.nav > li').removeClass('active');
                $(this).addClass('active');
            });
        });
        function executeScript(html)
        {

            var reg = /<script[^>]*>([^\x00]+)$/i;
            //对整段HTML片段按<\/script>拆分
            var htmlBlock = html.split("<\/script>");
            for (var i in htmlBlock)
            {
                var blocks;//匹配正则表达式的内容数组，blocks[1]就是真正的一段脚本内容，因为前面reg定义我们用了括号进行了捕获分组
                if (blocks = htmlBlock[i].match(reg))
                {
                    //清除可能存在的注释标记，对于注释结尾-->可以忽略处理，eval一样能正常工作
                    var code = blocks[1].replace(/<!--/, '');
                    try
                    {
                        eval(code) //执行脚本
                    }
                    catch (e)
                    {
                    }
                }
            }
        }

        /*
         * 利用div实现左边点击右边显示的效果（以id="content"的div进行内容展示）
         * 注意：
         *   ①：js获取网页的地址，是根据当前网页来相对获取的，不会识别根目录；
         *   ②：如果右边加载的内容显示页里面有css，必须放在主页（即例中的index.jsp）才起作用
         *   （如果单纯的两个页面之间include，子页面的css和js在子页面是可以执行的。 主页面也可以调用子页面的js。但这时要考虑页面中js和渲染的先后顺序 ）
        */
        function showAtRight(url) {
            var xmlHttp;
            if (window.XMLHttpRequest) {
                // code for IE7+, Firefox, Chrome, Opera, Safari
                xmlHttp=new XMLHttpRequest();    //创建 XMLHttpRequest对象
            }
            else {
                // code for IE6, IE5
                xmlHttp=new ActiveXObject("Microsoft.XMLHTTP");
            }

            xmlHttp.onreadystatechange=function() {
                //onreadystatechange — 当readystate变化时调用后面的方法

                if (xmlHttp.readyState == 4) {
                    //xmlHttp.readyState == 4    ——    finished downloading response

                    if (xmlHttp.status == 200) {
                        //xmlHttp.status == 200        ——    服务器反馈正常

                        document.getElementById("content").innerHTML=xmlHttp.responseText;    //重设页面中id="content"的div里的内容
                        executeScript(xmlHttp.responseText);    //执行从服务器返回的页面内容里包含的JavaScript函数
                    }
                    //错误状态处理
                    else if (xmlHttp.status == 404){
                        alert("出错了☹   （错误代码：404 Not Found），……！");
                        /* 对404的处理 */
                        return;
                    }
                    else if (xmlHttp.status == 403) {
                        alert("出错了☹   （错误代码：403 Forbidden），……");
                        /* 对403的处理  */
                        return;
                    }
                    else {
                        alert("出错了☹   （错误代码：" + request.status + "），……");
                        /* 对出现了其他错误代码所示错误的处理   */
                        return;
                    }
                }

              }

            //把请求发送到服务器上的指定文件（url指向的文件）进行处理
            xmlHttp.open("GET", url, true);        //true表示异步处理
            xmlHttp.send();
        }
        function LoadCompanyTrend() {
            $.post("/echarts/api/company", function (data) {
            var x = data["x_series"];
            var y = data["y_series"];
        //此处开始图表展示
        var myChart = echarts.init(document.getElementById('main'));
        option = {
            color: ['#ff3d3d'],
            tooltip: {
                trigger: 'axis'
            },
            legend: {
                x: 'left',
                padding: [10, 20, 0, 20],
                data: ['拜访次数'],
                selected: {
                    'VATS': true
                }
            },
            grid: {
                left: '0',
                right: '5%',
                bottom: '10%',
                top: '13%',
                containLabel: true
            },

            xAxis: {
                axisLabel :{
                    interval:0, //显示所有的x轴的数据
                    rotate: -45,
                    margin: 5
                } ,
                type: 'category',
                boundaryGap: false,
                splitLine: { //网格线
                    show: true,
                    lineStyle: {
                        color: ['#b1b1b1'],
                        type: 'dashed'
                    }
                },
                data:  x
            },
            yAxis: {
                splitLine: { //网格线
                    show: true,
                    lineStyle: {
                        color: ['#b1b1b1'],
                        type: 'dashed'
                    }
                }
            },
            series: [{
                name: 'VATS',
                type: 'line',
                data:  y,
                label: {
                    normal: {
                        show: true,
                        position: 'top' //值显示
                    }
                }
            }]
        };
        myChart.setOption(option)

        });//请求结束
        }
        function LoadPersonTrend(q) {
            $.post("/echarts/api/person",{q: q} ,function (data) {
            var x = data["x_series"];
            var y = data["y_series"];
        //此处开始图表展示
        var myChart = echarts.init(document.getElementById('main'));
        option = {
            color: ['#ff3d3d'],
            tooltip: {
                trigger: 'axis'
            },
            legend: {
                x: 'left',
                padding: [10, 20, 0, 20],
                data: ['拜访次数'],
                selected: {
                    'VATS': true
                }
            },
            grid: {
                left: '0',
                right: '5%',
                bottom: '10%',
                top: '13%',
                containLabel: true
            },

            xAxis: {
                axisLabel :{
                    interval:0, //显示所有的x轴的数据
                    rotate: -45,
                    margin: 5
                } ,
                type: 'category',
                boundaryGap: false,
                splitLine: { //网格线
                    show: true,
                    lineStyle: {
                        color: ['#b1b1b1'],
                        type: 'dashed'
                    }
                },
                data:  x
            },
            yAxis: {
                splitLine: { //网格线
                    show: true,
                    lineStyle: {
                        color: ['#b1b1b1'],
                        type: 'dashed'
                    }
                }
            },
            series: [{
                name: 'VATS',
                type: 'line',
                data:  y,
                label: {
                    normal: {
                        show: true,
                        position: 'top' //值显示
                    }
                }
            }]
        };
        myChart.setOption(option)

        });//请求结束
        }
        //触发趋势图中的下拉菜单的事件
        function show(){
            var objS = document.getElementById("mySelect");
            var grade = objS.options[objS.selectedIndex].value;
            //eval(grade);
        }
        //自动补全

        //查询按钮
        function LoadGranph() {
            var objS = document.getElementById("mySelect");
            var load = objS.options[objS.selectedIndex].value;  //下拉菜单
            var query = document.getElementById("q").value; //查询值
            var exec1 = load+"(\""+ query+"\")" ;
            eval(exec1);
            console.log(eval(exec1))
        }

        //公司数据表格汇总



    </script>


</body></html>